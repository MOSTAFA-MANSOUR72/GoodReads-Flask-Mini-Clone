{% extends 'home.html' %}
{% block title %} {{title}} - BookTracker {% endblock %}

{% block container %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
  <!-- Currently Reading Books -->
  <div class="lg:col-span-2">
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">{{title}}</h1>
      <div class="h-1 w-20 bg-gradient-to-r from-primary-600 to-blue-600 rounded"></div>
    </div>
    
    <div class="space-y-6">
      {% for book in books %}
      {% if book.id not in local_completed_books %} 
      <div class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
        <div class="md:flex">
          <div class="md:w-48 md:flex-shrink-0">
            <img src="{{url_for('static', filename=book.cover_image_url)}}" alt="{{book.title}} Cover" class="w-full h-64 md:h-full object-cover">
          </div>
          <div class="p-6 flex-1">
            <h3 class="text-xl font-bold text-gray-900 mb-2">{{ book.title }}</h3>
            <p class="text-primary-600 font-medium mb-2">{{ book.author }}</p>
            <p class="text-gray-600 text-sm mb-4">{{ book.description }}</p>
            <div class="flex items-center text-sm text-gray-500 mb-4">
              <i class="fas fa-file-alt mr-2"></i>
              <span>{{book.pages_number}} pages</span>
            </div>
            
            <!-- Progress Update Form -->
            <div class="bg-gray-50 rounded-lg p-4 mb-4">
              <form action="{{ url_for('views.update_progress', book_id=book.id) }}" method="post" class="space-y-3">
                <label for="current_page_{{book.id}}" class="block text-sm font-medium text-gray-700">Update Reading Progress</label>
                <div class="flex items-center space-x-3">
                  <input 
                    type="number" 
                    name="current_page" 
                    id="current_page_{{book.id}}" 
                    min="0" 
                    max="{{ book.pages_number }}" 
                    placeholder="{{ current_reading_books[book.id] }}" 
                    required
                    class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-primary-500 focus:border-primary-500"
                  >
                  <span class="text-gray-500">/ {{ book.pages_number }}</span>
                  <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors">
                    <i class="fas fa-check mr-1"></i>Update
                  </button>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-primary-600 h-2 rounded-full transition-all duration-300" style="width: {{ (current_reading_books[book.id] / book.pages_number * 100) if book.id in current_reading_books else 0 }}%"></div>
                </div>
                <p class="text-xs text-gray-500">
                  Progress: {{ current_reading_books[book.id] if book.id in current_reading_books else 0 }} / {{ book.pages_number }} pages 
                  ({{ "%.1f"|format((current_reading_books[book.id] / book.pages_number * 100) if book.id in current_reading_books else 0) }}%)
                </p>
              </form>
            </div>
            
            <!-- Remove from Currently Reading -->
            <form action="{{ url_for('views.update_currently_reading', book_id=book.id) }}" method="post">
              <button type="submit" class="w-full px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors font-medium">
                <i class="fas fa-bookmark-slash mr-2"></i>Remove from Currently Reading
              </button>
            </form>
          </div>
        </div>
      </div>
      {% endif %}
      {% endfor %}
      
      {% if not books or books|selectattr('id', 'in', local_completed_books)|list|length == books|length %}
      <div class="text-center py-12">
        <i class="fas fa-book-reader text-gray-300 text-6xl mb-4"></i>
        <h3 class="text-xl font-medium text-gray-900 mb-2">No books currently reading</h3>
        <p class="text-gray-500 mb-6">Start reading by adding books to your currently reading list!</p>
        <a href="{{url_for('views.explore')}}" class="inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors">
          <i class="fas fa-compass mr-2"></i>Explore Books
        </a>
      </div>
      {% endif %}
    </div>
  </div>
  
  <!-- Friends Activities Sidebar -->
  <div class="lg:col-span-1">
    <div class="bg-white rounded-xl shadow-lg overflow-hidden sticky top-24">
      <div class="bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-4">
        <h2 class="text-xl font-bold text-white flex items-center">
          <i class="fas fa-users mr-3"></i>
          Friends Activities
        </h2>
      </div>
      
      <div class="p-6 max-h-96 overflow-y-auto">
        {% for post in activities %}
        <div class="flex items-start space-x-3 mb-6 last:mb-0">
          <img src="{{url_for('static', filename=post.user.cover_image_url)}}" alt="{{post.user.username}}" class="w-12 h-12 rounded-full object-cover">
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between mb-1">
              <h4 class="text-sm font-medium text-gray-900 truncate">{{post.user.username}}</h4>
              <span class="text-xs text-gray-500">{{post.timestamp}}</span>
            </div>
            <p class="text-sm text-gray-600 mb-2">{{post.action}}</p>
            <div class="flex space-x-2">
              {% if post.user in followed_users %}
              <form action="{{ url_for('views.unfollow', user_id=post.user.id) }}" method="post" class="inline">
                <button class="px-3 py-1 text-xs bg-red-100 text-red-700 rounded-full hover:bg-red-200 transition-colors">
                  <i class="fas fa-user-minus mr-1"></i>Unfollow
                </button>
              </form>
              {% else %}
              <form action="{{ url_for('views.follow', user_id=post.user_id) }}" method="post" class="inline">
                <button class="px-3 py-1 text-xs bg-primary-100 text-primary-700 rounded-full hover:bg-primary-200 transition-colors">
                  <i class="fas fa-user-plus mr-1"></i>Follow
                </button>
              </form>
              {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
        
        {% if not activities %}
        <div class="text-center py-8">
          <i class="fas fa-user-friends text-gray-300 text-3xl mb-3"></i>
          <p class="text-gray-500 text-sm">No friend activities yet</p>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
